<!DOCTYPE html>
<html class="no-js" lang="en">

<head>
    {% load static %}
    <!-- Meta Tags -->
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Laralink">
    <!-- Favicon Icon -->
    <link rel="icon" href="assets/img/favicon.png" />
    <!-- Site Title -->
    <title>Vesperi</title>
    <link rel="stylesheet" type="text/css" href="{% static 'bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'animate.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'style.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'eventCard.css' %}">
</head>

<body class="cs-dark">
    <div class="cs-preloader cs-white_bg cs-center">
        <div class="cs-preloader_in">
            <img src="{% static 'images/Haffel-ticket.svg' %}" alt="Logsso">
        </div>
    </div>
    <!-- Start Header Section -->
    <header class="cs-site_header cs-style1 cs-sticky-header cs-primary_color text-uppercase cs-white_bg">
        <div class="cs-main_header">
            <div class="container">
                <div class="cs-main_header_in">
                    <div class="cs-main_header_left">
                        <a class="cs-site_branding cs-accent_color" href="index.html">
                            <img src="{% static 'images/Haffel-full-centered.png' %}" alt="Logo" class="cs-hide_white">

                        </a>
                    </div>
                    <div class="cs-main_header_center">
                        <div class="cs-nav">
                            <ul class="cs-nav_list">
                                <li class="menu-item-has-children"><a href="/org/homepage"
                                        class="cs-smoth_scroll">Home</a>
                                </li>
                                <li><a href="/org/Marketplace">Upcoming Games</a></li>
                                <li><a href="/org/create">Create</a></li>
                                <li><a href="/org/myEvents">My Games</a></li>
                                <li><a href="/org/scan-qr-code">Scan Tickets</a></li>
                                <li><a href="{% url 'Club:logoutUser' %}">logout</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="cs-main_header_right">
                        <div class="cs-toolbox">

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div class="cs-height_80 cs-height_lg_80"></div>

    <section id="team">
        <div class="cs-height_70 cs-height_lg_40"></div>
        <div class="container" style="height: 900px;">
            <center>
                <div id="scanner-container"></div>
            </center>
            <center>
                <div id="qr-reader" style="width:50%"></div>
            </center>

            <script src="https://unpkg.com/html5-qrcode"></script>

            <script>
                // Retrieve the CSRF token from the cookie
                function getCookie(name) {
                    var cookieValue = null;
                    if (document.cookie && document.cookie !== '') {
                        var cookies = document.cookie.split(';');
                        for (var i = 0; i < cookies.length; i++) {
                            var cookie = cookies[i].trim();
                            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                                break;
                            }
                        }
                    }
                    return cookieValue;
                }

                var csrfToken = getCookie('csrftoken');

                var resultContainer = document.getElementById('qr-reader-results');
                var lastResult, countResults = 0;

                function onSuccess(decodedText, decodedResult) {
                    if (decodedText !== lastResult) {
                        ++countResults;
                        lastResult = decodedText;
                        // Handle on success condition with the decoded message.
                        console.log('Scan result:', decodedText);

                        // Send the scanned QR code to the Django view
                        $.ajax({
                            url: '/org/check-qr-code/',
                            type: 'POST',
                            data: {
                                csrfmiddlewaretoken: csrfToken,
                                qr_code: decodedText
                            },
                            beforeSend: function (xhr, settings) {
                                if (!(/^http:.*/.test(settings.url) || /^https:.*/.test(settings.url))) {
                                    xhr.setRequestHeader("X-CSRFToken", csrfToken);
                                }
                            },
                            success: function (response) {
                                if (response.success == true) {

                                    alert("Successfully checked in ");
                                    location.reload();
                                }
                                else {
                                    alert("Invalide Qr Code");
                                    location.reload();
                                }
                                // Handle the success response from the Django view
                            },
                            error: function (xhr, status, error) {
                                console.log('Error:', error);
                                // Handle the error response from the Django view
                            }
                        });
                    }
                }

                var html5QrcodeScanner = new Html5QrcodeScanner(
                    "qr-reader", { fps: 10, qrbox: 250 });
                html5QrcodeScanner.render(onSuccess);
            </script>

        </div>

















        <script src="{% static 'jquery-3.6.0.min.js' %}"></script>
        <script src="{% static 'jquery.slick.min.js' %}"></script>
        <script src="{% static 'jquery.counter.min.js' %}"></script>
        <script src="{% static 'wow.min.js' %}"></script>
        <script src="{% static 'ripples.min.js' %}"></script>
        <script src="{% static 'main.js' %}"></script>
</body>





</html>